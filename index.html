<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Emergency Hand Sign Recognition</title>

  <script src="tf.min.js"></script>
  <script src="teachablemachine-image.min.js"></script>

  <style>
    body { font-family: Arial, sans-serif; text-align:center; padding:12px; }
    #video {
      width: 320px;
      height: 320px;
      background: #000;
      margin-top: 12px;
      border-radius: 8px;
    }
    button {
      padding: 12px 16px;
      font-size: 18px;
      border-radius: 6px;
    }
    #result { margin-top: 10px; font-weight: bold; }
  </style>
</head>

<body>

<h2>Emergency Hand Sign Recognition</h2>

<button id="startBtn">Start Camera</button>

<p id="result">Waiting...</p>

<video id="video" autoplay playsinline muted></video>
<canvas id="canvas" width="320" height="320" style="display:none;"></canvas>

<script>
let model;
let videoStream;

async function startCamera() {
  const video = document.getElementById("video");

  try {
    videoStream = await navigator.mediaDevices.getUserMedia({
      video: { facingMode: "environment" } // back camera
    });

    video.srcObject = videoStream;
    video.play();

    document.getElementById("result").innerText =
      "Camera ON. Loading model...";

    await loadModel();
  }
  catch (err) {
    document.getElementById("result").innerText =
      "Camera Error: " + err;
  }
}

async function loadModel() {
  try {
    model = await tmImage.load("model.json", "metadata.json");
    document.getElementById("result").innerText =
      "Model loaded. Recognizing...";
    requestAnimationFrame(loop);
  } catch (err) {
    document.getElementById("result").innerText =
      "Model Load Error: " + err;
  }
}

async function loop() {
  const video = document.getElementById("video");
  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");

  // draw video frame to canvas
  ctx.drawImage(video, 0, 0, 320, 320);

  const prediction = await model.predict(canvas);

  let best = prediction.reduce((a, b) =>
    a.probability > b.probability ? a : b
  );

  document.getElementById("result").innerText =
    best.className + " (" + (best.probability * 100).toFixed(1) + "%)";

  requestAnimationFrame(loop);
}

document.getElementById("startBtn").addEventListener("click", startCamera);
</script>

</body>
</html>
